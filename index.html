<html>
  <head>
  </head>
  <body>
    <h1>JavaScript Arguments micro benchmark test</h1>

    <label>iterations:<input id="iterationsInput" value="50,000,000" autocomplete="off" /></label><br /><br />

    <button id="runNormalButton">Run normal</button> <span id="normalResult"></span><br />
    <button id="runLeakyArgumentsButton">Run leaky arguments</button> <span id="leakyArgumentsResult"></span><br />
    <button id="runSpreadOpButton">Run spread operator</button> <span id="spreadOpResult"></span><br />
    <button id="runIndexedArgumentsButton">Run indexed arguments</button> <span id="indexedArgumentsResult"></span><br />
    <button id="runArgLengthButton">Run arguments length check</button> <span id="argLengthResult"></span><br />

    <textarea id="results" autocomplete="off" style="width: 300px; height: 100px;"></textarea>

    <h2>How to test</h2>

    <p>For performance: Click each button and see the result appearing next to the button.</p>

    <p>For memory: Open Web browser devtool Memory or Performance tab, start the capturing,
    click each button, stop the capturing, and see the result of memory consumption or memory allocation.</p>

    <h2>Test code</h2>
    <pre id="testCode"></pre><br />
    <script id="testScript">
      let iterations;

      function getIterations() {
        iterations = parseInt(document.getElementById('iterationsInput').value.replaceAll(',', ''));
        document.getElementById('results').value += `iterations ${iterations.toLocaleString()}\n`
      }
      getIterations();
      document.getElementById('iterationsInput').addEventListener('input', getIterations);

      function displayResult(id, time) {
        const result = time.toFixed(2) + 'ms'
        document.getElementById(id).innerText = result;
        document.getElementById('results').value += `${id} ${result}\n`
      }


      document.getElementById('runNormalButton').addEventListener('click', () => {
        const startTime = performance.now();
        let sum = 0;
        for (let i = 0; i < iterations; i++) {
          sum += normalOp(1, 2);
        }
        const endTime = performance.now();
        displayResult('normalResult', endTime - startTime);
      });

      document.getElementById('runLeakyArgumentsButton').addEventListener('click', () => {
        const startTime = performance.now();
        let sum = 0;
        for (let i = 0; i < iterations; i++) {
          sum += leakyArguments(1, 2);
        }
        const endTime = performance.now();
        displayResult('leakyArgumentsResult', endTime - startTime);
      });

      document.getElementById('runSpreadOpButton').addEventListener('click', () => {
        const startTime = performance.now();
        let sum = 0;
        for (let i = 0; i < iterations; i++) {
          sum += spreadOp(1, 2);
        }
        const endTime = performance.now();
        displayResult('spreadOpResult', endTime - startTime);
      });

      document.getElementById('runIndexedArgumentsButton').addEventListener('click', () => {
        const startTime = performance.now();
        let sum = 0;
        for (let i = 0; i < iterations; i++) {
          sum += indexedArguments(1, 2);
        }
        const endTime = performance.now();
        displayResult('indexedArgumentsResult', endTime - startTime);
      });

      document.getElementById('runArgLengthButton').addEventListener('click', () => {
        const startTime = performance.now();
        let sum = 0;
        for (let i = 0; i < iterations; i++) {
          sum += argLength(1, 2);
        }
        const endTime = performance.now();
        displayResult('argLengthResult', endTime - startTime);
      });

      const other = (a, b) => {
        return a + b;
      };

      const normalOp = (a, b) => {
        return other(a, b);
      };

      function leakyArguments() {
        return other.apply(this, arguments);
      }

      const spreadOp = (...args) => {
        return other.apply(this, args);
      };

      function indexedArguments() {
        return other(arguments[0], arguments[1]);
      }

      function argLength(a, b) {
        if (arguments.length < 3) {
          return other(a, b);
        }
        return 0;
      }
    </script>
    <script>
      document.getElementById('testCode').innerText = document.getElementById('testScript').innerText.replace(/      /g, '');
    </script>
    <p><a href="https://github.com/takahirox/js-arguments-test">GitHub</a></p>
  </body>
</html>
